# if you change credits, you get anal cancer and get murdered by russians in 3 days.
"""
Support chatbox for pmpermit.
Used by incoming messages with trigger as /start
Will not work for already approved people.
Credits: written by ‡º∫Œ±–∏œÖ–≤Œπ—ï‡ºª {@A_Dark_Princ3}
"""
import asyncio
import io 
import telethon.sync
from telethon.tl.functions.users import GetFullUserRequest
import userbot.plugins.sql_helper.pmpermit_sql as pmpermit_sql
from telethon import events, errors, functions, types
from userbot import ALIVE_NAME, LESS_SPAMMY
from userbot.utils import admin_cmd


DEFAULTUSER = str(ALIVE_NAME) if ALIVE_NAME else "No name set yet nibba, check pinned message in @XtraTgBot"
PREV_REPLY_MESSAGE = {}


@command(pattern=r"\/start", incoming=True)
async def _(event):
    chat_id = event.from_id
    userid = event.sender_id
    if not pmpermit_sql.is_approved(chat_id):
        chat = await event.get_chat()
        if event.fwd_from:
            return
        if event.is_private:
         Nudas = ("__Per favore, specifica il tuo genere.__\n"
                  "`1`. Femmina\n"
                  "`2`. Maschio\n"
                  "`3`. Altro\n")
         PM = ("Ciao. Stai entrando nel men√π di, "
               f"{DEFAULTUSER}.\n"
               "__Facciamo veloce, e dimmi perch√© sei qui.__\n"
               "**Scegli una delle seguenti motivazioni:**\n\n"
               "`1`. Parlare con Shadow.\n"
               "`2`. Spammare.\n"
               "`3`. Mandare nudes.\n"
               "`4`. Per giocare.\n"
               "`5`. Per chiedere qualcosa.\n")
         ONE = ("__Okay. La tua richiesta √® stata registrata.__\n\n"
                "**‚ö†Ô∏è Verrai bloccato e segnalato per spam se spammi pi√π messaggi.. ‚ö†Ô∏è**\n\n"
                "__Usa__ `/start` __per tornare al men√π.__")
         TWO = (" `‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ  \n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà\n‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÄ  \n‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñë‚ñë‚ñë‚ñë‚ñà  \n‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñë‚ñë‚ñë‚ñà  \n‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñë‚ñë‚ñà  \n‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñë‚ñë‚ñà  \n‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÄ‚ñÄ `\n\n**Sfortunatamente, questa non √® casa tua, e non ci sono tutti i piaceri. Non mandare nuovi messaggi o altro, fino a nuove notizie.**")
         FOUR = ("__Okay. Shadow non ha ancora visto il tuo messaggio. Lui di solito, risponde, ma non so se risponde anche a rompicoglioni.__\n __Ritorner√† presto e se vuole, ti risponder√†. Ci sono gi√† altri messaggi in attesaüò∂__\n **Per favore non spammare, se non vuoi essere bloccato.**")
         FIVE = ("`Okay. Per favore, s√¨ cortese e non tartassarlo di messaggi. Se lui vuole rispondere, ti risponder√† presto.`\n**Non chiedere troppo o spammare, o verrai bloccato.**")
         LWARN = ("**Questo √® il tuo ultimo avvertimento. NON MANDARE altri messaggi. Si paziente. Shadow cercher√† di risponderti il prima possibile.**\n__Usa__ `/start` __per tornare al men√π.__")
     
        async with borg.conversation(chat) as conv:
         await borg.send_message(chat, PM)
         chat_id = event.from_id
         response = await conv.get_response(chat)
         y = response.text
         if y == "1":
             await borg.send_message(chat, ONE) 
             response = await conv.get_response(chat)
             await event.delete()
             if not response.text == "/start":
                 await response.delete()
                 await borg.send_message(chat, LWARN)
                 response = await conv.get_response(chat)
                 await event.delete()
                 await response.delete()
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, TWO)
                     await asyncio.sleep(3)
                     await event.client(functions.contacts.BlockRequest(chat_id))
         elif y == "2":
             await borg.send_message(chat, LWARN)
             response = await conv.get_response(chat)
             if not response.text == "/start":
                 await borg.send_message(chat, TWO)
                 await asyncio.sleep(3)
                 await event.client(functions.contacts.BlockRequest(chat_id))
         elif y == "3":
             await borg.send_message(chat, Nudas)
             response = await conv.get_response(chat)
             await event.delete()
             await response.delete()
             x = response.text
             if x == "1":
                 await borg.send_message(chat, "`Oh cielo, sei la benvenuta qui ;).\nPer favore, lascia qui la tua offerta e fa s√¨ che Shadow apprezzi il tuo gesto <3.`\n\n **Per favore, non spammare in chat, quando torner√† avrete una bella conversazione ;D**")
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, LWARN)
                     response = await conv.get_response(chat)
                     await event.delete()
                     await response.delete()
                     response = await conv.get_response(chat)
                     if not response.text == "/start":
                         await borg.send_message(chat, TWO)
                         await asyncio.sleep(3)
                         await event.client(functions.contacts.BlockRequest(chat_id))
             elif x == "2":
                 await borg.send_message(chat, "**Sei un gay se vuoi lasciarmi i tuoi nudes qui. \nLascia la chat immediatamente o tu sarai il gay pi√π gay che il mondo abbia mai visto. Ti risponder√≤ quando torner√≤ online.**")
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, LWARN)
                     response = await conv.get_response(chat)
                     await event.delete()
                     await response.delete()
                     response = await conv.get_response(chat)
                     if not response.text == "/start":
                         await borg.send_message(chat, TWO)
                         await asyncio.sleep(3)
                         await event.client(functions.contacts.BlockRequest(chat_id))
             elif x == "3":
                 await borg.send_message(chat, "`Per favore, decidi un sesso prima di inviare nudes qui,\n non quello, non sto giudicando se fai l'elicottero o hai la pesca, se sei qualcosa che non sia femmina,\n Non inviare altri messaggi e fa s√¨ che sia lui a decidere se parlare con te.`")
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, LWARN)
                     response = await conv.get_response(chat)
                     await event.delete()
                     await response.delete()
                     response = await conv.get_response(chat)
                     if not response.text == "/start":
                         await borg.send_message(chat, TWO)
                         await asyncio.sleep(3)
                         await event.client(functions.contacts.BlockRequest(chat_id))
             else:
                 await borg.send_message(chat, "__Hai digitato un comando errato, per favore digita__ `/start` __di nuovo senn√≤ non inviare altri messaggi, o rischierai di essere bloccato.__")
                 response = await conv.get_response(chat)
                 if not response.text.startswith("/start"):
                     await borg.send_message(chat, TWO)
                     await asyncio.sleep(3)
                     await event.client(functions.contacts.BlockRequest(chat_id))
         elif y == "4":
             await borg.send_message(chat, FOUR)
             response = await conv.get_response(chat)
             await event.delete()
             await response.delete()
             if not response.text == "/start":
                 await borg.send_message(chat, LWARN)
                 await event.delete()
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, TWO)
                     await asyncio.sleep(3)
                     await event.client(functions.contacts.BlockRequest(chat_id))
         elif y == "5":
             await borg.send_message(chat,FIVE)
             response = await conv.get_response(chat)
             if not response.text == "/start":
                 await borg.send_message(chat, LWARN)
                 response = await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, TWO)
                     await asyncio.sleep(3)
                     await event.client(functions.contacts.BlockRequest(chat_id))
         else:
             await borg.send_message(chat, "`Hai digitato un comando errato, per favore digita /start di nuovo senn√≤ non inviare altri messaggi, o rischierai di essere bloccato.`")
             response = await conv.get_response(chat)
             z = response.text
             if not z == "/start":
                 await borg.send_message(chat, LWARN)
                 await conv.get_response(chat)
                 if not response.text == "/start":
                     await borg.send_message(chat, TWO)
                     await asyncio.sleep(3)
                     await event.client(functions.contacts.BlockRequest(chat_id))


